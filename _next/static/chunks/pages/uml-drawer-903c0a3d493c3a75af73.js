(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[467],{5744:function(e,t,n){"use strict";n.r(t);var r=n(5893),i=n(7757),a=n.n(i),h=n(2137),o=n(6610),s=n(5991),c=n(7294),u=n(3642),l=n(282),f=n(3258),d=n(5996),g=n(9446),w=n(4540),x=n(3098),m=n(3403),v=n(553),y=n(4436),p=n(5445),_=n(74),b=n(7162),k=n(2571),j=n(7443),S=n(7320),Z=n.n(S),C=n(1018),I=n.n(C);function T(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,i=function(){};return{s:i,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,h=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return h=e.done,e},e:function(e){o=!0,a=e},f:function(){try{h||null==n.return||n.return()}finally{if(o)throw a}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var F="http://www.plantuml.com/plantuml/img/",A=function(){function e(t,n,r,i,a,h){var s=arguments.length>6&&void 0!==arguments[6]?arguments[6]:"";(0,o.Z)(this,e),this.cls=t,this.score=n,this.x=r,this.y=i,this.width=a,this.height=h,this.ref=s}return(0,s.Z)(e,[{key:"collision",value:function(e){return this.x<e.x+e.width&&this.x+this.width>e.width&&this.y<e.y+e.height&&this.y+this.height>e.y}},{key:"top",value:function(){return{x:this.x,y:this.y,width:this.width,height:0}}},{key:"top2",value:function(){return{x:this.x,y:this.y-this.height,width:this.width,height:this.height}}},{key:"bottom",value:function(){return{x:this.x,y:this.y+this.height,width:this.width,height:0}}},{key:"bottom2",value:function(){return{x:this.x,y:this.y+this.height+this.height,width:this.width,height:this.height}}},{key:"right",value:function(){return{x:this.x+this.width,y:this.y,width:0,height:this.height}}},{key:"right2",value:function(){return{x:this.x+this.width,y:this.y,width:this.width,height:this.height}}},{key:"left",value:function(){return{x:this.x,y:this.y,width:0,height:this.height}}},{key:"left2",value:function(){return{x:this.x-this.width,y:this.y,width:this.width,height:this.height}}},{key:"rightTop",value:function(){return{x:this.x+this.width/2,y:this.y,width:this.width/2,height:this.height/2}}},{key:"rightTop2",value:function(){return{x:this.x+this.width/2,y:this.y-this.y/2,width:this.width,height:this.height}}},{key:"rightBottom",value:function(){return{x:this.x+this.width/2,y:this.y+this.y/2,width:this.width/2,height:this.height/2}}},{key:"rightBottom2",value:function(){return{x:this.x+this.width/2,y:this.y+this.y/2,width:this.width,height:this.height}}},{key:"leftTop",value:function(){return{x:this.x,y:this.y,width:this.width/2,height:this.height/2}}},{key:"leftTop2",value:function(){return{x:this.x-this.width/2,y:this.y-this.height/2,width:this.width,height:this.height}}},{key:"leftBottom",value:function(){return{x:this.x,y:this.y+this.height/2,width:this.width/2,height:this.height/2}}},{key:"leftBottom2",value:function(){return{x:this.x-this.width/2,y:this.y+this.height/2,width:this.width,height:this.height}}}]),e}();t.default=function(){var e=(0,c.useState)(!1),t=e[0],n=e[1],i=(0,c.useState)("brush"),o=i[0],s=i[1],S=(0,c.useState)(""),C=S[0],E=S[1],D=(0,c.useState)(""),B=D[0],R=D[1],X=(0,c.useState)(!0),N=X[0],M=X[1],Y=(0,c.useState)("architecture"),q=Y[0],O=Y[1],P=(0,c.useState)(!1),L=P[0],U=P[1],W=(0,c.useState)(),Q=W[0],z=W[1],$=(0,c.useState)(),G=$[0],H=$[1],J=(0,c.useState)(),K=J[0],V=J[1],ee=(0,c.useState)(),te=ee[0],ne=ee[1],re=(0,c.useState)(),ie=re[0],ae=re[1],he=(0,c.useState)(),oe=he[0],se=he[1],ce=(0,c.useState)([]),ue=ce[0],le=ce[1],fe=(0,c.useState)(),de=fe[0],ge=fe[1],we=(0,c.useState)({x:0,y:0}),xe=(we[0],we[1]),me=(0,c.useState)({x:0,y:0}),ve=me[0],ye=me[1],pe={1:{name:"usecase"},2:{name:"actor"},3:{name:"actor_with_label"},4:{name:"rectangle"},5:{name:"rectangle_with_label"},6:{name:"note"},7:{name:"arrow_right"},8:{name:"arrow_left"},9:{name:"arrow_up"},10:{name:"arrow_down"},11:{name:"arrow_right_up"},12:{name:"arrow_right_down"},13:{name:"arrow_left_up"},14:{name:"arrow_left_down"}},_e={1:{name:"participant"},2:{name:"actor"},3:{name:"actor_with_label"},4:{name:"database"},5:{name:"database_with_label"},6:{name:"lifeline"},7:{name:"arow_right"},8:{name:"arrow_right_with_label"},9:{name:"arrow_left"},10:{name:"arrow_left_with_label"},11:{name:"arrow_self"},12:{name:"arrow_self_with_label"}},be={1:{name:"arrow_right"},2:{name:"arrow_left"},3:{name:"arrow_up"},4:{name:"arrow_down"},5:{name:"arrow_right_up"},6:{name:"arrow_right_down"},7:{name:"arrow_left_up"},8:{name:"arrow_left_down"},9:{name:"user"},10:{name:"server"},11:{name:"database"},21:{name:"number_1"},22:{name:"number_2"},23:{name:"number_3"},24:{name:"number_4"},25:{name:"number_5"},26:{name:"number_6"},27:{name:"number_7"},28:{name:"number_8"},29:{name:"number_9"},30:{name:"number_10"}},ke=[7,8,9,10,11,12,13,14];(0,c.useEffect)((function(){if(!t){console.log("constructor");try{var e=document.getElementById("canvas"),r=document.createElement("canvas"),i=document.getElementById("canvas2"),a=[e.width,e.height];r.width=a[0],r.height=a[1],z(e),H(r),V(i);var h=e.getContext("2d");h&&ne(h);var o=r.getContext("2d");o&&ae(o);var s=i.getContext("2d");s&&se(s),Xe(e,r,h,o),k.CQI("webgl");var c=je(q);(0,j.YL)(c).then((function(e){return ge(e)})),n(!0)}catch(u){console.log(u)}}}));var je=function(e){var t="tfjs_models/web_model/model.json";return"sequence"==e&&(t="tfjs_models/seq_model/model.json"),"architecture"==e&&(t="tfjs_models/arc_model/model.json"),t},Se=function(e,t){if(te&&ie&&G){U(!0),"brush"===o?(ie.strokeStyle="black",ie.lineWidth=1):"eraser"===o&&(ie.strokeStyle="white",ie.lineWidth=20);var n=Ie(e,t);xe(n),ye(n),ue.push(ie.getImageData(0,0,G.width,G.height))}},Ze=function(e,t){if(L){if(!ie||!te||!Q)return;var n=Ie(e,t);ie.beginPath(),ie.moveTo(ve.x,ve.y),ie.lineTo(n.x,n.y),ie.stroke(),te.putImageData(ie.getImageData(0,0,Q.width,Q.height),0,0),ye(n)}},Ce=function(){U(!1),Te()},Ie=function(e,t){var n={x:0,y:0};return Q&&(n={x:e-Q.getBoundingClientRect().left,y:t-Q.getBoundingClientRect().top}),n},Te=function(){var e=(0,h.Z)(a().mark((function e(){var t,n;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=2;break}return e.abrupt("return");case 2:if("usecase"!=q){e.next=6;break}Ee(),e.next=21;break;case 6:if("sequence"!=q){e.next=14;break}return e.next=9,Fe(3,7,1);case 9:t=e.sent,console.log(t),Ae(t,_e),e.next=21;break;case 14:if("architecture"!=q){e.next=21;break}return e.next=17,Fe(5,4,6);case 17:n=e.sent,console.log(n),Ae(n,be),De(n,be);case 21:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Ee=function(){var e=(0,h.Z)(a().mark((function e(){var t,n,r,i,h,o,s,c,u,l,f,d;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(N){e.next=2;break}return e.abrupt("return");case 2:if(Q&&te&&de){e.next=4;break}return e.abrupt("return");case 4:return t=k.Xhn.fromPixels(Q),n=t.toInt().transpose([0,1,2]).expandDims(),e.next=8,de.executeAsync(n);case 8:for(r=e.sent,Array.isArray(r)||(r=[r]),i=r[1].arraySync(),h=r[2].arraySync(),o=r[5].dataSync(),s=[],h[0].forEach((function(e,t){if(e>.5){var n=i[0][t][0]*Q.height,r=i[0][t][1]*Q.width,a=i[0][t][2]*Q.height,h=i[0][t][3]*Q.width;s.push(new A(o[t],e.toFixed(4),r,n,h-r,a-n))}})),c=0,u=s;c<u.length;c++)l=u[c],te.strokeStyle="#00FF00",te.strokeRect(l.x,l.y,l.width,l.height),te.font="21px serif",te.fillStyle="#00FF00",f=pe[l.cls].name,d=(100*Number(l.score)).toFixed(2),te.fillText("".concat(l.cls,": ").concat(f,", ").concat(d," %"),l.x,l.y);Be(s);case 17:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Fe=function(){var e=(0,h.Z)(a().mark((function e(t,n,r){var i,h,o,s,c,u,l;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(Q&&de){e.next=2;break}return e.abrupt("return",[]);case 2:return i=k.Xhn.fromPixels(Q),h=i.toInt().transpose([0,1,2]).expandDims(),e.next=6,de.executeAsync(h);case 6:return o=e.sent,Array.isArray(o)||(o=[o]),s=o[t].arraySync(),c=o[n].arraySync(),u=o[r].dataSync(),l=[],c[0].forEach((function(e,t){if(e>.5){var n=s[0][t][0]*Q.height,r=s[0][t][1]*Q.width,i=s[0][t][2]*Q.height,a=s[0][t][3]*Q.width;l.push(new A(u[t],e.toFixed(4),r,n,a-r,i-n))}})),e.abrupt("return",l);case 14:case"end":return e.stop()}}),e)})));return function(t,n,r){return e.apply(this,arguments)}}(),Ae=function(e,t){if(te){te.strokeStyle="#00FF00",te.font="21px serif",te.fillStyle="#00FF00";var n,r=T(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;te.strokeRect(i.x,i.y,i.width,i.height);var a=t[i.cls]?t[i.cls].name:"unknown",h=(100*Number(i.score)).toFixed(2);te.fillText("".concat(i.cls,": ").concat(a,", ").concat(h," %"),i.x,i.y)}}catch(o){r.e(o)}finally{r.f()}}},De=function(e,t){if(oe&&K){oe.clearRect(0,0,K.width,K.height);var n,r=T(e);try{var i=function(){var e,r=n.value,i=t[r.cls]?t[r.cls].name:"unknown",a="arrow_right"==(e=i)?"images/arrow_right.svg":"arrow_left"==e?"images/arrow_left.svg":"arrow_up"==e?"images/arrow_up.svg":"arrow_down"==e?"images/arrow_down.svg":"arrow_right_up"==e?"images/arrow_right_up.svg":"arrow_right_down"==e?"images/arrow_right_down.svg":"arrow_left_up"==e?"images/arrow_left_up.svg":"arrow_left_down"==e?"images/arrow_left_down.svg":"user"==e?"images/user.svg":"server"==e?"images/server.svg":"database"==e?"images/database.svg":"";if(""!=a){var h=new Image;h.src=a,h.onload=function(){var e=r.x+r.width/2-h.width/2,t=r.y+r.height/2-h.height/2;oe.drawImage(h,e,t)}}};for(r.s();!(n=r.n()).done;)i()}catch(a){r.e(a)}finally{r.f()}}},Be=function(){var e=(0,h.Z)(a().mark((function e(t){var n,r,i,h,o,s,c,u,l,f,d,g,w,x;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="",r=T(t),e.prev=2,r.s();case 4:if((i=r.n()).done){e.next=35;break}if(1!=(h=i.value).cls){e.next=14;break}return o=null===ie||void 0===ie?void 0:ie.getImageData(h.x,h.y,h.width,h.height),e.next=10,Re(o);case 10:return s=e.sent,h.ref="(".concat(s,")"),n+="".concat(h.ref,"\n"),e.abrupt("continue",33);case 14:if(2!=h.cls){e.next=18;break}return h.ref=":actor:",n+="".concat(h.ref,"\n"),e.abrupt("continue",33);case 18:if(!ke.indexOf(h.cls)){e.next=33;break}if(c=null,u=null,!(h.cls=7)){e.next=27;break}l=T(t);try{for(l.s();!(f=l.n()).done;)((d=f.value).collision(h.right())||d.collision(h.right2()))&&(u=d),(d.collision(h.left())||d.collision(h.left2()))&&(c=d)}catch(a){l.e(a)}finally{l.f()}if(!c||""===c.ref||!u||""===u.ref){e.next=27;break}return n+="".concat(c.ref," --\x3e ").concat(u.ref,"\n"),e.abrupt("break",35);case 27:if(!(h.cls=9)){e.next=33;break}g=T(t);try{for(g.s();!(w=g.n()).done;)((x=w.value).collision(h.top())||x.collision(h.top2()))&&(u=x),(x.collision(h.bottom())||x.collision(h.bottom2()))&&(c=x)}catch(a){g.e(a)}finally{g.f()}if(!c||""===c.ref||!u||""===u.ref){e.next=33;break}return n+="".concat(c.ref," --\x3e ").concat(u.ref,"\n"),e.abrupt("break",35);case 33:e.next=4;break;case 35:e.next=40;break;case 37:e.prev=37,e.t0=e.catch(2),r.e(e.t0);case 40:return e.prev=40,r.f(),e.finish(40);case 43:E(n),""!=n&&R(F+I().encode(n));case 45:case"end":return e.stop()}}),e,null,[[2,37,40,43]])})));return function(t){return e.apply(this,arguments)}}(),Re=function(){var e=(0,h.Z)(a().mark((function e(t){var n,r,i,h;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(G&&t){e.next=2;break}return e.abrupt("return");case 2:return(n=document.createElement("canvas")).width=t.width,n.height=t.height,null===(r=n.getContext("2d"))||void 0===r||r.putImageData(t,0,0),e.next=9,Z().recognize(n,"eng");case 9:return i=e.sent,h=i.data.text,e.abrupt("return",h.replace(/[\n\(\)]/g,""));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),Xe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;Q&&te&&G&&ie&&(e=Q,t=G,n=te,r=ie),e&&t&&n&&r&&(n.fillStyle="white",n.fillRect(0,0,e.width,e.height),r.fillStyle="white",r.fillRect(0,0,t.width,t.height)),le([])};return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(u.Z,{container:!0,children:[(0,r.jsxs)(u.Z,{item:!0,xs:6,children:[(0,r.jsx)("p",{children:"canvas"}),(0,r.jsxs)("div",{children:[(0,r.jsx)(l.Z,{onClick:function(){Xe()},variant:"outlined",startIcon:(0,r.jsx)(d.Z,{}),children:"Clear"}),(0,r.jsx)(l.Z,{onClick:function(){!function(){if(ue.length>0){var e=ue.pop();e&&ie&&te&&(ie.putImageData(e,0,0),te.putImageData(e,0,0))}}()},variant:"outlined",children:(0,r.jsx)(g.Z,{})}),(0,r.jsx)(v.Z,{control:(0,r.jsx)(f.Z,{checked:N,onChange:function(e){M(e.target.checked)}}),label:"exec()"}),(0,r.jsxs)(p.Z,{value:q,onChange:function(e){O(e.target.value),k.CQI("webgl");var t=je(e.target.value);(0,j.YL)(t).then((function(e){return ge(e)}))},children:[(0,r.jsx)("option",{value:"usecase",children:"Usecase"}),(0,r.jsx)("option",{value:"sequence",children:"Sequence"}),(0,r.jsx)("option",{value:"architecture",children:"architecture"})]}),(0,r.jsx)("a",{id:"download",onClick:function(e){Q&&(console.log("download"),e.target.href=Q.toDataURL("image/jpeg"))},children:"DL\uff08\u53f3\u30af\u30ea\u30c3\u30af\uff09"}),(0,r.jsx)(y.Z,{component:"fieldset",children:(0,r.jsxs)(b.Z,{row:!0,children:[(0,r.jsx)(v.Z,{label:"brush",control:(0,r.jsx)(_.Z,{value:"brush",checked:"brush"===o,onClick:function(){s("brush")},color:"primary",icon:(0,r.jsx)(w.Z,{color:"disabled"}),checkedIcon:(0,r.jsx)(w.Z,{})})}),(0,r.jsx)(v.Z,{value:"eraser",label:"eraser",control:(0,r.jsx)(_.Z,{value:"eraser",checked:"eraser"===o,onClick:function(){s("eraser")},color:"secondary",icon:(0,r.jsx)(x.Z,{color:"disabled"}),checkedIcon:(0,r.jsx)(x.Z,{})})})]})})]}),(0,r.jsx)("canvas",{id:"canvas",width:"500",height:"500",onMouseDown:function(e){Se(e.pageX,e.pageY)},onMouseMove:function(e){Ze(e.pageX,e.pageY)},onMouseUp:function(e){Ce()},onTouchStart:function(e){e.changedTouches.length>0&&Se(e.changedTouches[0].pageX,e.changedTouches[0].pageY)},onTouchMove:function(e){e.changedTouches.length>0&&Ze(e.changedTouches[0].pageX,e.changedTouches[0].pageY)},onTouchEnd:function(e){Ce()},onTouchCancel:function(e){Ce()},style:{border:"1px solid black"}})]}),(0,r.jsxs)(u.Z,{item:!0,xs:6,children:[(0,r.jsx)("p",{children:"view"}),(0,r.jsxs)(u.Z,{container:!0,children:[(0,r.jsx)(u.Z,{item:!0,xs:12,children:(0,r.jsx)(m.Z,{id:"text",fullWidth:!0,multiline:!0,variant:"outlined",value:C,onChange:function(e){E(e.target.value),""!=e.target.value&&R(F+I().encode(e.target.value))}})}),(0,r.jsx)(u.Z,{item:!0,xs:12,children:(0,r.jsx)("img",{src:B})})]}),(0,r.jsx)("p",{children:"canvas2"}),(0,r.jsx)("canvas",{id:"canvas2",width:"500",height:"500",style:{border:"1px solid black"}})]})]})})}},7377:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/uml-drawer",function(){return n(5744)}])},5410:function(){},8628:function(){},1601:function(){},7792:function(){},5042:function(){}},function(e){e.O(0,[774,447,80,57,925,888,179],(function(){return t=7377,e(e.s=t);var t}));var t=e.O();_N_E=t}]);