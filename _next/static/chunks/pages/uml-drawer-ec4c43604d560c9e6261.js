(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[467],{5744:function(e,t,n){"use strict";n.r(t);var i=n(5893),r=n(7757),a=n.n(r),h=n(2137),o=n(6610),s=n(7294),c=n(5258),l=n(3642),u=n(4775),g=n(4456),d=n(9446),m=n(1959),f=n(3098),w=n(7239),p=n(2516),v=n(6869),x=n(4849),_=n(8884),y=n(4593),b=n(5639),j=n(7812),Z=n(8358),S=n(6447),k=n(2318),C=n(2571),I=n(7443),T=n(3907);function D(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return E(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return E(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var i=0,r=function(){};return{s:r,n:function(){return i>=e.length?{done:!0}:{done:!1,value:e[i++]}},e:function(e){throw e},f:r}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,h=!0,o=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return h=e.done,e},e:function(e){o=!0,a=e},f:function(){try{h||null==n.return||n.return()}finally{if(o)throw a}}}}function E(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=new Array(t);n<t;n++)i[n]=e[n];return i}var P=function e(t,n,i,r,a,h){(0,o.Z)(this,e),this.cls=t,this.score=n,this.x=i,this.y=r,this.width=a,this.height=h};t.default=function(){var e=(0,s.useState)(!1),t=e[0],n=e[1],r=(0,s.useState)(null),o=r[0],E=r[1],A=(0,s.useState)("brush"),R=A[0],F=A[1],M=(0,s.useState)(!0),B=M[0],O=(M[1],(0,s.useState)("architecture")),X=O[0],z=(O[1],(0,s.useState)(!1)),N=z[0],U=z[1],Y=(0,s.useState)(),L=Y[0],W=Y[1],Q=(0,s.useState)(),$=Q[0],q=Q[1],G=(0,s.useState)(),H=G[0],J=G[1],K=(0,s.useState)(),V=K[0],ee=K[1],te=(0,s.useState)(),ne=te[0],ie=te[1],re=(0,s.useState)(),ae=re[0],he=re[1],oe=(0,s.useState)([]),se=oe[0],ce=oe[1],le=(0,s.useState)(),ue=le[0],ge=le[1],de=(0,s.useState)({x:0,y:0}),me=(de[0],de[1]),fe=(0,s.useState)({x:0,y:0}),we=fe[0],pe=fe[1],ve=(0,s.useState)([]),xe=ve[0],_e=ve[1],ye={1:{name:"user",width:100,height:100,path:"images/user.svg"},2:{name:"server",width:100,height:100,path:"images/server.svg"},3:{name:"database",width:100,height:100,path:"images/database.svg"},4:{name:"laptop",width:100,height:100,path:"images/laptop.svg"},5:{name:"mobile",width:100,height:100,path:"images/mobile.svg"},6:{name:"text"},7:{name:"arrow_right",width:100,height:100,path:"images/arrow_right.svg"},8:{name:"arrow_left",width:100,height:100,path:"images/arrow_left.svg"},9:{name:"arrow_up",width:100,height:100,path:"images/arrow_up.svg"},10:{name:"arrow_down",width:100,height:100,path:"images/arrow_down.svg"},11:{name:"arrow_right_up",width:100,height:100,path:"images/arrow_right_up.svg"},12:{name:"arrow_right_down",width:100,height:100,path:"images/arrow_right_down.svg"},13:{name:"arrow_left_up",width:100,height:100,path:"images/arrow_left_up.svg"},14:{name:"arrow_left_down",width:100,height:100,path:"images/arrow_left_down.svg"},15:{name:"arrow_both_horizon",width:100,height:100,path:"images/arrow_both_horizon.svg"},16:{name:"arrow_both_vertical",width:100,height:100,path:"images/arrow_both_vertical.svg"},17:{name:"arrow_both_right_up",width:100,height:100,path:"images/arrow_both_right_up.svg"},18:{name:"arrow_both_right_down",width:100,height:100,path:"images/arrow_both_right_down.svg"},19:{name:"line_horizon",width:100,height:100,path:"images/line_horizon.svg"},20:{name:"line_vertical",width:100,height:100,path:"images/line_vertical.svg"},21:{name:"line_right_up",width:100,height:100,path:"images/line_right_up.svg"},22:{name:"line_right_down",width:100,height:100,path:"images/line_right_down.svg"},23:{name:"number_1",width:100,height:100,path:"images/number_1"},24:{name:"number_2",width:100,height:100,path:"images/number_2"},25:{name:"number_3",width:100,height:100,path:"images/number_3"},26:{name:"number_4",width:100,height:100,path:"images/number_4"},27:{name:"number_5",width:100,height:100,path:"images/number_5"},28:{name:"number_6",width:100,height:100,path:"images/number_6"},29:{name:"number_7",width:100,height:100,path:"images/number_7"},30:{name:"number_8",width:100,height:100,path:"images/number_8"},31:{name:"number_9",width:100,height:100,path:"images/number_9"},32:{name:"number_10",width:100,height:100,path:"images/number_10"}};(0,s.useEffect)((function(){if(!t){console.log("constructor");try{var e=document.getElementById("canvas"),i=document.createElement("canvas"),r=document.getElementById("canvas2"),a=[e.width,e.height];i.width=a[0],i.height=a[1],W(e),q(i),J(r);var h=e.getContext("2d");h&&ee(h);var o=i.getContext("2d");o&&ie(o);var s=r.getContext("2d");s&&he(s),Pe(e,i,h,o),C.CQI("webgl");var c=be(X);(0,I.YL)(c).then((function(e){return ge(e)})),n(!0)}catch(l){console.log(l)}}}));var be=function(e){return"tfjs_models/arc_model/model.json"},je=function(e,t){var n=t[e]?t[e]:null;return n&&n.path?n.path:""},Ze=function(e,t){if(V&&ne&&$){U(!0),"brush"===R?(ne.strokeStyle="black",ne.lineWidth=1):"eraser"===R&&(ne.strokeStyle="white",ne.lineWidth=20);var n=Ce(e,t);me(n),pe(n),se.push(ne.getImageData(0,0,$.width,$.height))}},Se=function(e,t){if(N){if(!ne||!V||!L)return;var n=Ce(e,t);ne.beginPath(),ne.moveTo(we.x,we.y),ne.lineTo(n.x,n.y),ne.stroke(),V.putImageData(ne.getImageData(0,0,L.width,L.height),0,0),pe(n)}},ke=function(){U(!1),Ie()},Ce=function(e,t){var n={x:0,y:0};return L&&(n={x:e-L.getBoundingClientRect().left,y:t-L.getBoundingClientRect().top}),n},Ie=function(){var e=(0,h.Z)(a().mark((function e(){var t;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(B){e.next=2;break}return e.abrupt("return");case 2:if(_e([]),"architecture"!=X){e.next=10;break}return e.next=6,Te(1,0,4);case 6:t=e.sent,De(t,ye),Ee(t,ye),_e(t);case 10:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),Te=function(){var e=(0,h.Z)(a().mark((function e(t,n,i){var r,h,o,s,c,l,u;return a().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L&&ue){e.next=2;break}return e.abrupt("return",[]);case 2:return r=C.Xhn.fromPixels(L),h=r.toInt().transpose([0,1,2]).expandDims(),e.next=6,ue.executeAsync(h);case 6:return o=e.sent,Array.isArray(o)||(o=[o]),s=o[t].arraySync(),c=o[n].arraySync(),l=o[i].dataSync(),u=[],c[0].forEach((function(e,t){if(e>.5){var n=s[0][t][0]*L.height,i=s[0][t][1]*L.width,r=s[0][t][2]*L.height,a=s[0][t][3]*L.width;u.push(new P(l[t],e.toFixed(4),i,n,a-i,r-n))}})),e.abrupt("return",u);case 14:case"end":return e.stop()}}),e)})));return function(t,n,i){return e.apply(this,arguments)}}(),De=function(e,t){if(V){V.strokeStyle="#00FF00",V.font="21px serif",V.fillStyle="#00FF00";var n,i=D(e);try{for(i.s();!(n=i.n()).done;){var r=n.value;V.strokeRect(r.x,r.y,r.width,r.height);var a=t[r.cls]?t[r.cls].name:"unknown",h=(100*Number(r.score)).toFixed(2);V.fillText("".concat(r.cls,": ").concat(a,", ").concat(h," %"),r.x,r.y)}}catch(o){i.e(o)}finally{i.f()}}},Ee=function(e,t){if(ae&&H&&ne){ae.clearRect(0,0,H.width,H.height);var n,i=D(e);try{var r=function(){var e=n.value;if("text"==(t[e.cls]?t[e.cls].name:"unknown")){var i=ne.getImageData(e.x,e.y,e.width,e.height);ae.putImageData(i,e.x,e.y)}else{var r=je(e.cls,t);if(""!=r){var a=new Image;a.src=r,a.onload=function(){var t=e.x+e.width/2-a.width/2,n=e.y+e.height/2-a.height/2;ae.drawImage(a,t,n)}}}};for(i.s();!(n=i.n()).done;)r()}catch(a){i.e(a)}finally{i.f()}}},Pe=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;L&&V&&$&&ne&&(e=L,t=$,n=V,i=ne),e&&t&&n&&i&&(n.fillStyle="white",n.fillRect(0,0,e.width,e.height),i.fillStyle="white",i.fillRect(0,0,t.width,t.height)),ce([])};return(0,i.jsx)(i.Fragment,{children:(0,i.jsxs)(l.Z,{container:!0,children:[(0,i.jsx)(c.Z,{position:"static",children:(0,i.jsxs)(Z.Z,{children:[(0,i.jsx)(k.Z,{variant:"h6",children:"Diagramer"}),(0,i.jsx)(S.ZP,{title:"Menu",children:(0,i.jsx)(j.Z,{onClick:function(e){E(e.currentTarget)},children:(0,i.jsx)(_.Z,{style:{color:"white"}})})}),(0,i.jsxs)(y.Z,{anchorEl:o,anchorOrigin:{vertical:"bottom",horizontal:"center"},transformOrigin:{vertical:"top",horizontal:"center"},keepMounted:!0,open:Boolean(o),onClose:function(){E(null)},children:[(0,i.jsxs)(b.Z,{children:[(0,i.jsx)(k.Z,{variant:"inherit",children:"500x500"}),(0,i.jsx)(v.Z,{children:(0,i.jsx)(m.Z,{})})]}),(0,i.jsx)(b.Z,{children:(0,i.jsx)(k.Z,{variant:"inherit",style:{color:"gray"},children:"700x500"})})]}),(0,i.jsx)(S.ZP,{title:"Brush",children:(0,i.jsx)(j.Z,{onClick:function(){F("brush")},children:(0,i.jsx)(u.Z,{style:{color:"brush"==R?"red":"white"}})})}),(0,i.jsx)(S.ZP,{title:"Eraser",children:(0,i.jsx)(j.Z,{onClick:function(){F("eraser")},children:(0,i.jsx)(g.Z,{style:{color:"eraser"==R?"red":"white"}})})}),(0,i.jsx)(S.ZP,{title:"Undo",children:(0,i.jsx)(j.Z,{onClick:function(){!function(){if(se.length>0){var e=se.pop();e&&ne&&V&&(ne.putImageData(e,0,0),V.putImageData(e,0,0))}}()},children:(0,i.jsx)(d.Z,{style:{color:"white"}})})}),(0,i.jsx)(S.ZP,{title:"Clear All",children:(0,i.jsx)(j.Z,{onClick:function(){Pe()},children:(0,i.jsx)(f.Z,{style:{color:"white"}})})}),(0,i.jsx)(S.ZP,{title:"Download Image file",children:(0,i.jsx)(j.Z,{onClick:function(){H&&H.toBlob((function(e){var t=URL.createObjectURL(e),n=document.createElement("a");n.download="diagram.png",n.href=t,n.click(),n.remove()}),"image/png")},children:(0,i.jsx)(x.Z,{style:{color:"white"}})})}),(0,i.jsx)(S.ZP,{title:"Download pptx file",children:(0,i.jsx)(j.Z,{onClick:function(){!function(){var e,t=new T.Z,n=t.addSlide(),i=D(xe);try{for(i.s();!(e=i.n()).done;){var r=e.value;if("text"==(ye[r.cls]?ye[r.cls].name:"unknown")){if(ne){var a=document.createElement("canvas");a.width=r.width,a.height=r.height;var h=a.getContext("2d"),o=ne.getImageData(r.x,r.y,r.width,r.height);null===h||void 0===h||h.putImageData(o,0,0);var s=a.toDataURL(),c=r.x/100,l=r.y/100,u=r.width/100,g=r.height/100;n.addImage({data:s,x:c,y:l,w:u,h:g}),a.remove()}}else{var d=je(r.cls,ye);if(""!=d){var m=(r.x+r.width/2-50)/100,f=(r.y+r.height/2-50)/100;n.addImage({path:d,x:m,y:f})}}}}catch(w){i.e(w)}finally{i.f()}t.writeFile()}()},children:(0,i.jsx)(w.Z,{style:{color:"white"}})})}),(0,i.jsx)(S.ZP,{title:"https://github.com/n-fukuju/shakyo",children:(0,i.jsx)(j.Z,{href:"https://github.com/n-fukuju/shakyo",children:(0,i.jsx)(p.Z,{style:{color:"white"}})})})]})}),(0,i.jsx)(l.Z,{item:!0,xs:6,children:(0,i.jsxs)(l.Z,{container:!0,children:[(0,i.jsx)(l.Z,{item:!0,xs:12,children:(0,i.jsx)(k.Z,{variant:"caption",children:"Drawing Canvas"})}),(0,i.jsx)("canvas",{id:"canvas",width:"500",height:"500",onMouseDown:function(e){Ze(e.pageX,e.pageY)},onMouseMove:function(e){Se(e.pageX,e.pageY)},onMouseUp:function(e){ke()},onTouchStart:function(e){e.changedTouches.length>0&&Ze(e.changedTouches[0].pageX,e.changedTouches[0].pageY)},onTouchMove:function(e){e.changedTouches.length>0&&Se(e.changedTouches[0].pageX,e.changedTouches[0].pageY)},onTouchEnd:function(e){ke()},onTouchCancel:function(e){ke()},style:{border:"1px solid black"}})]})}),(0,i.jsx)(l.Z,{item:!0,xs:6,children:(0,i.jsxs)(l.Z,{container:!0,children:[(0,i.jsx)(l.Z,{item:!0,xs:12,children:(0,i.jsx)(k.Z,{variant:"caption",children:"Result"})}),(0,i.jsx)("canvas",{id:"canvas2",width:"500",height:"500",style:{border:"1px solid black"}})]})})]})})}},7377:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/uml-drawer",function(){return n(5744)}])},5410:function(){},8628:function(){},1601:function(){},7792:function(){},3180:function(){},7687:function(){},5042:function(){}},function(e){e.O(0,[774,491,452,958,828,812,888,179],(function(){return t=7377,e(e.s=t);var t}));var t=e.O();_N_E=t}]);