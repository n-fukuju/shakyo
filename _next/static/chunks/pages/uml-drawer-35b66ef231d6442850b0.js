(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[467],{5744:function(e,t,n){"use strict";n.r(t);var r=n(5893),a=n(7757),i=n.n(a),o=n(2137),c=n(6610),u=n(5991),s=n(7294),l=n(3642),h=n(282),f=n(5996),d=n(9446),g=n(4540),x=n(3098),p=n(6575),m=n(553),v=n(4436),w=n(74),y=n(7162),b=n(2571),j=n(7443),k=n(7320),_=n.n(k),S=n(1018),Z=n.n(S);function C(e,t){var n;if("undefined"===typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(!e)return;if("string"===typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return T(e,t)}(e))||t&&e&&"number"===typeof e.length){n&&(e=n);var r=0,a=function(){};return{s:a,n:function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}},e:function(e){throw e},f:a}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,o=!0,c=!1;return{s:function(){n=e[Symbol.iterator]()},n:function(){var e=n.next();return o=e.done,e},e:function(e){c=!0,i=e},f:function(){try{o||null==n.return||n.return()}finally{if(c)throw i}}}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var I=function(){function e(t,n,r,a,i,o){(0,c.Z)(this,e),this.cls=t,this.score=n,this.x=r,this.y=a,this.width=i,this.height=o}return(0,u.Z)(e,[{key:"collision",value:function(e){return this.x<e.x+e.width&&this.x+this.width>e.width&&this.y<e.y+e.height&&this.y+this.height>e.y}}]),e}();t.default=function(){var e=(0,s.useState)(!1),t=e[0],n=e[1],a=(0,s.useState)("brush"),c=a[0],u=a[1],k=(0,s.useState)(""),S=k[0],T=k[1],E=(0,s.useState)(""),D=E[0],A=E[1],F=(0,s.useState)(!1),X=F[0],M=F[1],N=(0,s.useState)(),R=N[0],Y=N[1],O=(0,s.useState)(),P=O[0],B=O[1],L=(0,s.useState)(),U=L[0],W=L[1],z=(0,s.useState)(),Q=z[0],$=z[1],q=(0,s.useState)([]),G=q[0],H=q[1],J=(0,s.useState)(),K=J[0],V=J[1],ee=(0,s.useState)({x:0,y:0}),te=(ee[0],ee[1]),ne=(0,s.useState)({x:0,y:0}),re=ne[0],ae=ne[1],ie={1:{name:"usecase"},2:{name:"actor"},3:{name:"actor_with_label"},4:{name:"rectangle"},5:{name:"rectangle_with_label"},6:{name:"note"},7:{name:"arrow_right"},8:{name:"arrow_left"},9:{name:"arrow_up"},10:{name:"arrow_down"},11:{name:"arrow_right_up"},12:{name:"arrow_right_down"},13:{name:"arrow_left_up"},14:{name:"arrow_left_down"}};(0,s.useEffect)((function(){if(!t){console.log("constructor");try{var e=document.getElementById("canvas"),r=document.createElement("canvas"),a=[e.width,e.height];r.width=a[0],r.height=a[1],Y(e),B(r);var i=e.getContext("2d");i&&W(i);var o=r.getContext("2d");o&&$(o),de(e,r,i,o),b.CQI("webgl"),(0,j.YL)("tfjs_models/web_model/model.json").then((function(e){return V(e)})),n(!0)}catch(c){console.log(c)}}}));var oe=function(e,t){if(U&&Q&&P){M(!0),"brush"===c?(Q.strokeStyle="black",Q.lineWidth=1):"eraser"===c&&(Q.strokeStyle="white",Q.lineWidth=20);var n=se(e,t);te(n),ae(n),G.push(Q.getImageData(0,0,P.width,P.height))}},ce=function(e,t){if(X){if(!Q||!U||!R)return;var n=se(e,t);Q.beginPath(),Q.moveTo(re.x,re.y),Q.lineTo(n.x,n.y),Q.stroke(),U.putImageData(Q.getImageData(0,0,R.width,R.height),0,0),ae(n)}},ue=function(){M(!1),le()},se=function(e,t){var n={x:0,y:0};return R&&(n={x:e-R.getBoundingClientRect().left,y:t-R.getBoundingClientRect().top}),n},le=function(){var e=(0,o.Z)(i().mark((function e(){var t,n,r,a,o,c,u,s,l,h,f,d;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(R&&U&&K){e.next=2;break}return e.abrupt("return");case 2:return t=b.Xhn.fromPixels(R),n=t.toInt().transpose([0,1,2]).expandDims(),e.next=6,K.executeAsync(n);case 6:for(r=e.sent,Array.isArray(r)||(r=[r]),a=r[1].arraySync(),o=r[2].arraySync(),c=r[5].dataSync(),u=[],o[0].forEach((function(e,t){if(e>.5){var n=a[0][t][0]*R.height,r=a[0][t][1]*R.width,i=a[0][t][2]*R.height,o=a[0][t][3]*R.width;u.push(new I(c[t],e.toFixed(4),r,n,o-r,i-n))}})),s=0,l=u;s<l.length;s++)h=l[s],U.strokeStyle="#00FF00",U.strokeRect(h.x,h.y,h.width,h.height),U.font="21px serif",U.fillStyle="#00FF00",f=ie[h.cls].name,d=(100*Number(h.score)).toFixed(2),U.fillText("".concat(h.cls,": ").concat(f,", ").concat(d," %"),h.x,h.y);he(u);case 15:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),he=function(){var e=(0,o.Z)(i().mark((function e(t){var n,r,a,o,c,u;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n="",r=C(t),e.prev=2,r.s();case 4:if((a=r.n()).done){e.next=18;break}if(1!=(o=a.value).cls){e.next=13;break}return c=null===Q||void 0===Q?void 0:Q.getImageData(o.x,o.y,o.width,o.height),e.next=10,fe(c);case 10:return u=e.sent,n+="(".concat(u,")\n"),e.abrupt("continue",16);case 13:if(2!=o.cls){e.next=16;break}return n+=":actor:\n",e.abrupt("continue",16);case 16:e.next=4;break;case 18:e.next=23;break;case 20:e.prev=20,e.t0=e.catch(2),r.e(e.t0);case 23:return e.prev=23,r.f(),e.finish(23);case 26:T(n),""!=n&&A("http://www.plantuml.com/plantuml/img/"+Z().encode(n));case 28:case"end":return e.stop()}}),e,null,[[2,20,23,26]])})));return function(t){return e.apply(this,arguments)}}(),fe=function(){var e=(0,o.Z)(i().mark((function e(t){var n,r,a,o;return i().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(P&&t){e.next=2;break}return e.abrupt("return");case 2:return(n=document.createElement("canvas")).width=t.width,n.height=t.height,null===(r=n.getContext("2d"))||void 0===r||r.putImageData(t,0,0),e.next=9,_().recognize(n,"eng");case 9:return a=e.sent,o=a.data.text,e.abrupt("return",o.replace(/[\n\(\)]/g,""));case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}(),de=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;R&&U&&P&&Q&&(e=R,t=P,n=U,r=Q),e&&t&&n&&r&&(n.fillStyle="white",n.fillRect(0,0,e.width,e.height),r.fillStyle="white",r.fillRect(0,0,t.width,t.height)),H([])};return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)(l.Z,{container:!0,children:[(0,r.jsxs)(l.Z,{item:!0,xs:6,children:[(0,r.jsx)("p",{children:"canvas"}),(0,r.jsxs)("div",{children:[(0,r.jsx)(h.Z,{onClick:function(){de()},variant:"outlined",startIcon:(0,r.jsx)(f.Z,{}),children:"Clear"}),(0,r.jsx)(h.Z,{onClick:function(){!function(){if(G.length>0){var e=G.pop();e&&U&&U.putImageData(e,0,0)}}()},variant:"outlined",children:(0,r.jsx)(d.Z,{})}),(0,r.jsx)("a",{id:"download",onClick:function(e){R&&(console.log("download"),e.target.href=R.toDataURL("image/jpeg"))},children:"DL\uff08\u53f3\u30af\u30ea\u30c3\u30af\uff09"}),(0,r.jsx)(v.Z,{component:"fieldset",children:(0,r.jsxs)(y.Z,{row:!0,children:[(0,r.jsx)(m.Z,{label:"brush",control:(0,r.jsx)(w.Z,{value:"brush",checked:"brush"===c,onClick:function(){u("brush")},color:"primary",icon:(0,r.jsx)(g.Z,{color:"disabled"}),checkedIcon:(0,r.jsx)(g.Z,{})})}),(0,r.jsx)(m.Z,{value:"eraser",label:"eraser",control:(0,r.jsx)(w.Z,{value:"eraser",checked:"eraser"===c,onClick:function(){u("eraser")},color:"secondary",icon:(0,r.jsx)(x.Z,{color:"disabled"}),checkedIcon:(0,r.jsx)(x.Z,{})})})]})})]}),(0,r.jsx)("canvas",{id:"canvas",width:"500",height:"500",onMouseDown:function(e){oe(e.pageX,e.pageY)},onMouseMove:function(e){ce(e.pageX,e.pageY)},onMouseUp:function(e){ue()},onTouchStart:function(e){e.changedTouches.length>0&&oe(e.changedTouches[0].pageX,e.changedTouches[0].pageY)},onTouchMove:function(e){e.changedTouches.length>0&&ce(e.changedTouches[0].pageX,e.changedTouches[0].pageY)},onTouchEnd:function(e){ue()},onTouchCancel:function(e){ue()},style:{border:"1px solid black"}})]}),(0,r.jsxs)(l.Z,{item:!0,xs:6,children:[(0,r.jsx)("p",{children:"view"}),(0,r.jsxs)(l.Z,{container:!0,children:[(0,r.jsx)(l.Z,{item:!0,xs:12,children:(0,r.jsx)(p.Z,{id:"text",fullWidth:!0,multiline:!0,variant:"outlined",value:S,onChange:function(e){T(e.target.value)}})}),(0,r.jsx)(l.Z,{item:!0,xs:12,children:(0,r.jsx)("img",{src:D})})]})]})]})})}},7377:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/uml-drawer",function(){return n(5744)}])},5410:function(){},8628:function(){},1601:function(){},7792:function(){},5042:function(){}},function(e){e.O(0,[774,447,127,57,971,888,179],(function(){return t=7377,e(e.s=t);var t}));var t=e.O();_N_E=t}]);